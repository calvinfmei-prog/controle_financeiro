<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-950 text-slate-200 min-h-screen">

<header class="p-6 border-b border-slate-800">
  <h1 class="text-2xl font-bold">ðŸ’³ Meu Financeiro</h1>
  <p class="text-slate-400">VisÃ£o geral do mÃªs</p>
</header>

<section class="p-6 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-6">
  <div class="bg-slate-900 rounded-xl p-5">
    <p class="text-slate-400 text-sm">Saldo Atual</p>
    <h2 id="saldoAtual" class="text-2xl font-bold text-green-400">R$ --</h2>
  </div>

  <div class="bg-slate-900 rounded-xl p-5">
    <p class="text-slate-400 text-sm">Despesas Fixas</p>
    <h2 id="fixas" class="text-2xl font-bold">R$ --</h2>
  </div>

  <div class="bg-slate-900 rounded-xl p-5">
    <p class="text-slate-400 text-sm">Parcelas do MÃªs</p>
    <h2 id="parcelas" class="text-2xl font-bold">R$ --</h2>
  </div>

  <div class="bg-slate-900 rounded-xl p-5">
    <p class="text-slate-400 text-sm">Saldo Projetado</p>
    <h2 id="saldoProjetado" class="text-2xl font-bold">R$ --</h2>
  </div>

  <div class="bg-slate-900 rounded-xl p-5 border border-blue-500">
    <p class="text-slate-400 text-sm">Pode gastar por dia</p>
    <h2 id="gastoDia" class="text-2xl font-bold text-blue-400">R$ --</h2>
  </div>
</section>
<section class="p-6 max-w-xl">
  <div class="bg-slate-900 p-6 rounded-xl">
    <h3 class="text-xl font-semibold mb-4">âž• Novo LanÃ§amento</h3>

    <form id="formLancamento" class="grid gap-3">
      <input type="date" required class="bg-slate-800 p-2 rounded" />
      
      <select class="bg-slate-800 p-2 rounded">
        <option value="SaÃ­da">SaÃ­da</option>
        <option value="Entrada">Entrada</option>
      </select>

      <input type="text" placeholder="DescriÃ§Ã£o" required class="bg-slate-800 p-2 rounded" />
      <input type="number" step="0.01" placeholder="Valor" required class="bg-slate-800 p-2 rounded" />

      <input type="text" placeholder="Categoria" class="bg-slate-800 p-2 rounded" />

      <button class="bg-green-500 text-black p-2 rounded font-semibold">
        Salvar
      </button>
    </form>

    <p id="msg" class="mt-3 text-sm"></p>
  </div>
</section>
<script>
  function carregarDashboard(data) {
    const d = data.dashboard

    document.getElementById('saldoAtual').innerText =
      (d.saldoAtual || 0).toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      })

    document.getElementById('fixas').innerText =
      data.fixas
        .reduce((s, i) => s + i.valor, 0)
        .toLocaleString('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        })

    document.getElementById('parcelas').innerText =
      (d.parcelasMes || 0).toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      })

    document.getElementById('saldoProjetado').innerText =
      (d.saldoProjetado || 0).toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      })

    document.getElementById('gastoDia').innerText =
      (d.gastoDia || 0).toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      })
  }
</script>

<script src="https://script.google.com/macros/s/AKfycbzPGIYM1pUTCLN26afnFZAeIuAjTnULlwubgsi94FYCFC7VCEFJY-0jfTms3jNbYSpNpA/exec?callback=carregarDashboard"></script>
<script>
  const API_POST =
    'https://script.google.com/macros/s/AKfycbzPGIYM1pUTCLN26afnFZAeIuAjTnULlwubgsi94FYCFC7VCEFJY-0jfTms3jNbYSpNpA/exec'

  document
    .getElementById('formLancamento')
    .addEventListener('submit', async e => {
      e.preventDefault()

      const f = e.target

      const payload = {
        data: f.data.value,
        tipo: f.tipo.value,
        descricao: f.descricao.value,
        valor: Number(f.valor.value),
        categoria: f.categoria.value
      }

      await fetch(API_POST, {
        method: 'POST',
        mode: 'no-cors', // ðŸ”‘ ESSENCIAL
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })

      document.getElementById('msg').innerText =
        'âœ… LanÃ§amento salvo com sucesso!'

      f.reset()

      // Recarrega dashboard apÃ³s salvar
      const s = document.createElement('script')
      s.src = API_POST + '?callback=carregarDashboard&t=' + Date.now()
      document.body.appendChild(s)
    })
</script>


</body>
</html>
